<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Academy | Painel de Controle</title>

    <!-- Bootstrap 5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /*--------------------------------------------------------------
        # Variaveis de Cores & Estilo Base
        --------------------------------------------------------------*/
        :root {
            --primary-color: #00e5ff;
            --primary-glow: rgba(0, 229, 255, 0.55);
            --background-color: #0a0a0c;
            --surface-color: rgba(15, 17, 26, 0.5);
            --text-color: #ffffff; /* Changed from #e0e0e0 for better visibility */
            --text-white-color: #cccccc; /* Changed from #8c8c8c for better visibility */
            --border-color: rgba(255, 255, 255, 0.1);
            --success-color: #00ff8c;
            --danger-color: #ff4d4d;
            --warning-color: #ffc700;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9)), url('back.png');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            color: var(--text-color);
            overflow-x: hidden;
        }

            thead th { 
                color: white; 
            }

            /* 2. Adicione esta nova regra para o corpo da tabela */
            tbody td {
                color: rgba(255, 255, 255, 0.5);
            }

        /*--------------------------------------------------------------
        # Efeito Glassmorphism e Componentes
        --------------------------------------------------------------*/
        .glass-effect {
            background: var(--surface-color);
            backdrop-filter: blur(15px) saturate(180%);
            -webkit-backdrop-filter: blur(15px) saturate(180%);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        .glass-effect:hover {
            border-color: var(--primary-color);
            box-shadow: 0 0 30px rgba(0, 229, 255, 0.15);
        }

        .navbar-brand, .nav-link {
            color: var(--text-color) !important;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .nav-link.active, .navbar-brand:hover, .nav-link:hover {
            color: var(--primary-color) !important;
            text-shadow: 0 0 10px var(--primary-glow);
        }
        
        .main-content .page { display: none; }
        .main-content .page.active {
            display: block;
            animation: fadeIn 0.8s ease-out;
        }
        
        .stat-card { text-align: center; padding: 1.5rem; }
        .stat-card .icon { font-size: 2.5rem; color: var(--primary-color); text-shadow: 0 0 15px var(--primary-glow); }
        .stat-card .stat-number { font-size: 2.5rem; font-weight: 700; color: var(--text-color); }
        .stat-card .card-title { color: var(--text-white-color); font-size: 0.9rem; }

        .btn-primary { background-color: var(--primary-color); border: 1px solid var(--primary-color); color: #0a0a0c; font-weight: 600; transition: all 0.3s ease; }
        .btn-primary:hover { background-color: transparent; color: var(--primary-color); box-shadow: 0 0 20px var(--primary-glow); }
        
        .table { --bs-table-bg: transparent; --bs-table-border-color: var(--border-color); --bs-table-color: var(--text-color); --bs-table-hover-color: var(--primary-color); --bs-table-hover-bg: rgba(0, 229, 255, 0.05); }
        thead th { color: var(--primary-color); }

        .dropdown-menu { --bs-dropdown-bg: rgba(30, 30, 40, 0.9); --bs-dropdown-border-color: var(--border-color); --bs-dropdown-link-color: var(--text-color); --bs-dropdown-link-hover-color: var(--primary-color); --bs-dropdown-link-hover-bg: rgba(0, 229, 255, 0.1); backdrop-filter: blur(10px); }
        
        .modal-content { border: none; }
        .modal-header, .modal-footer { border-color: var(--border-color); }
        .form-control, .form-select { background-color: rgba(0,0,0,0.2); border-color: var(--border-color); color: var(--text-color); }
        .form-control:focus, .form-select:focus { background-color: rgba(0,0,0,0.3); border-color: var(--primary-color); box-shadow: 0 0 10px var(--primary-glow); color: var(--text-color); }
        .form-control.is-invalid { border-color: var(--danger-color); }
        .form-check-input:checked { background-color: var(--primary-color); border-color: var(--primary-color); }

        .toast-container { z-index: 1100; }
        
        .toast {
            background-color: var(--surface-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: .75rem;
        }
        .toast-header {
            color: var(--primary-color);
            background-color: transparent;
            border-bottom: 1px solid var(--border-color);
        }
        .toast-body {
            color: var(--text-color);
        }
        .toast-header .btn-close {
            filter: invert(1) grayscale(100%) brightness(200%);
        }
        .badge {
            color: var(--background-color) !important;
            font-weight: 600;
        }
        
        .progress {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .progress-bar {
            background: linear-gradient(90deg, var(--primary-color), #00aaff);
        }

        .icon-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 229, 255, 0.1);
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .section-title { color: var(--text-color); margin-bottom: 0.5rem; font-weight: 600; }
        .section-subtitle { color: var(--text-white-color); margin-bottom: 2rem; }
        .section-title span { color: var(--primary-color); }

        .compact-navbar {
            max-width: 1270px; /* Adjust as needed */
            margin-left: auto;
            margin-top: 0.8rem;
            margin-right: auto;
            padding: 0.5rem 1rem; /* Make it more compact */
        }
    </style>
</head>
<body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg glass-effect sticky-top compact-navbar">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <a class="navbar-brand" href="#"><i class="bi bi-lightning-charge-fill"></i> Neon Academy</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item"><a class="nav-link active" href="#" data-page="dashboard">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-page="clientes">Clientes</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-page="planos">Planos</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-page="aulas">Aulas</a></li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link d-block link-light text-decoration-none dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="Luiz.png" alt="avatar" width="32" height="32" class="rounded-circle">
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end text-small">
                            <li><a class="dropdown-item" href="#">Meu Perfil</a></li>
                            <li><a class="dropdown-item" href="#">Configurações</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#">Sair</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- TOAST (Notificações) -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="appToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle"></strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastBody"></div>
        </div>
    </div>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="main-content container py-5">

        <!-- PÁGINA: DASHBOARD -->
        <section id="dashboard" class="page active">
            <h2 class="section-title">Painel de <span>Controle</span></h2>
            <p class="section-subtitle">Visão geral e estatísticas chave da academia.</p>
            <div class="row g-4 mb-4">
                <div class="col-xl-3 col-md-6"><div class="card glass-effect stat-card"><div class="icon"><i class="bi bi-people-fill"></i></div><h3 id="dashboard-clients" class="stat-number">0</h3><p class="card-title">Clientes Ativos</p></div></div>
                <div class="col-xl-3 col-md-6"><div class="card glass-effect stat-card"><div class="icon"><i class="bi bi-clipboard-data-fill"></i></div><h3 id="dashboard-plans" class="stat-number">0</h3><p class="card-title">Planos Cadastrados</p></div></div>
                <div class="col-xl-3 col-md-6"><div class="card glass-effect stat-card"><div class="icon"><i class="bi bi-calendar-check-fill"></i></div><h3 id="dashboard-classes" class="stat-number">0</h3><p class="card-title">Total de Aulas</p></div></div>
                <div class="col-xl-3 col-md-6"><div class="card glass-effect stat-card"><div class="icon"><i class="bi bi-bell-fill"></i></div><h3 class="stat-number" data-target="5">5</h3><p class="card-title">Notificações</p></div></div>
            </div>
            
            <div class="row g-4">
                <!-- Coluna Principal: Agenda da Semana -->
                <div class="col-lg-8">
                    <div class="card glass-effect h-100">
                        <div class="card-body">
                            <h5 class="card-title mb-3" style="color: var(--primary-color);">Agenda da Semana</h5>
                            <div id="upcoming-classes-container"></div>
                        </div>
                    </div>
                </div>
                <!-- Coluna Lateral: Novos Membros -->
                <div class="col-lg-4">
                    <div class="card glass-effect h-100">
                        <div class="card-body">
                            <h5 class="card-title mb-3" style="color: var(--primary-color);">Novos Membros</h5>
                            <div id="recent-clients-container"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PÁGINA: LISTA DE CLIENTES -->
        <section id="clientes" class="page">
            <h2 class="section-title">Gerenciar <span>Clientes</span></h2>
            <p class="section-subtitle">Adicione, edite e visualize os membros da academia.</p>
            <div class="card glass-effect"><div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <button class="btn btn-primary" id="btn-add-client"><i class="bi bi-plus-circle"></i> Novo Cliente</button>
                    <input type="text" id="clientSearch" class="form-control" style="max-width: 300px;" placeholder="Buscar cliente por nome...">
                </div>
                <div class="table-responsive"><table class="table table-hover align-middle"><thead><tr><th>Nome</th><th>Plano Atribuído</th><th>Status</th><th>Ações</th></tr></thead><tbody id="clientTableBody"></tbody></table></div>
            </div></div>
        </section>
        
        <!-- PÁGINA: PLANOS DE TREINO -->
        <section id="planos" class="page">
            <h2 class="section-title">Planos de <span>Treino</span></h2>
            <p class="section-subtitle">Crie e gerencie os planos de treino personalizados.</p>
            <div class="d-flex justify-content-end mb-3">
                <button class="btn btn-primary" id="btn-add-plan"><i class="bi bi-plus-circle"></i> Criar Novo Plano</button>
            </div>
            <div id="plansContainer" class="row g-4"></div>
        </section>

        <!-- PÁGINA: AULAS -->
        <section id="aulas" class="page">
            <h2 class="section-title">Agendamento de <span>Aulas</span></h2>
            <p class="section-subtitle">Visualize e agende as aulas coletivas da semana.</p>
             <div class="card glass-effect"><div class="card-body">
                 <div class="d-flex justify-content-end mb-3">
                    <button class="btn btn-primary" id="btn-add-class"><i class="bi bi-calendar-plus"></i> Agendar Nova Aula</button>
                </div>
                <div class="table-responsive"><table class="table table-hover align-middle"><thead><tr><th>Data</th><th>Horário</th><th>Modalidade</th><th>Instrutor</th><th>Vagas</th><th>Ações</th></tr></thead><tbody id="classesTableBody"></tbody></table></div>
            </div></div>
        </section>
    </main>

    <!-- MODAIS -->
    <!-- Modal Cliente -->
    <div class="modal fade" id="clientModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content glass-effect">
        <div class="modal-header"><h5 class="modal-title" id="clientModalTitle"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
            <form id="clientForm" class="row g-3 needs-validation" novalidate>
                <input type="hidden" id="clientId">
                <div class="col-md-6"><label for="clientName" class="form-label">Nome Completo</label><input type="text" class="form-control" id="clientName" required></div>
                <div class="col-md-6"><label for="clientEmail" class="form-label">Email</label><input type="email" class="form-control" id="clientEmail" required></div>
                <div class="col-md-6"><label for="clientAge" class="form-label">Idade</label><input type="number" class="form-control" id="clientAge" required></div>
                <div class="col-md-6"><label for="clientGoal" class="form-label">Objetivo</label><select class="form-select" id="clientGoal" required><option value="Hipertrofia">Hipertrofia</option><option value="Perda de Peso">Perda de Peso</option><option value="Condicionamento">Condicionamento</option></select></div>
                <div class="col-md-6"><label for="clientStatus" class="form-label">Status</label><select class="form-select" id="clientStatus" required><option value="Ativo">Ativo</option><option value="Inativo">Inativo</option></select></div>
                <div class="col-md-6"><label for="clientPlan" class="form-label">Atribuir Plano de Treino</label><select class="form-select" id="clientPlan"><option value="">Nenhum</option></select></div>
            </form>
        </div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="submit" form="clientForm" class="btn btn-primary">Salvar</button></div>
    </div></div></div>

    <!-- Modal Plano -->
    <div class="modal fade" id="planModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content glass-effect">
        <div class="modal-header"><h5 class="modal-title" id="planModalTitle"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
            <form id="planForm" class="needs-validation" novalidate>
                <input type="hidden" id="planId">
                <div class="row g-3">
                    <div class="col-md-6"><label for="planName" class="form-label">Nome do Plano</label><input type="text" class="form-control" id="planName" required></div>
                    <div class="col-md-6"><label for="planDuration" class="form-label">Duração</label><input type="text" class="form-control" id="planDuration" placeholder="Ex: 8 semanas" required></div>
                    <div class="col-md-6"><label for="planLevel" class="form-label">Nível</label><select class="form-select" id="planLevel" required><option value="Iniciante">Iniciante</option><option value="Intermediário">Intermediário</option><option value="Avançado">Avançado</option></select></div>
                    <div class="col-md-6"><label for="planResponsible" class="form-label">Responsável</label><input type="text" class="form-control" id="planResponsible" required></div>
                    <div class="col-12"><h6>Exercícios</h6><div id="exercisesContainer"></div><button type="button" id="addExercise" class="btn btn-sm btn-outline-primary mt-2">Adicionar Exercício</button></div>
                </div>
            </form>
        </div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="submit" form="planForm" class="btn btn-primary">Salvar Plano</button></div>
    </div></div></div>
    
    <!-- Modal Aulas -->
    <div class="modal fade" id="classModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered modal-lg"><div class="modal-content glass-effect">
        <div class="modal-header"><h5 class="modal-title" id="classModalTitle"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
            <form id="classForm" class="row g-3 needs-validation" novalidate>
                <input type="hidden" id="classId">
                <div class="col-md-6"><label for="classDate" class="form-label">Data</label><input type="date" class="form-control" id="classDate" required></div>
                <div class="col-md-6"><label for="classTime" class="form-label">Horário</label><input type="time" class="form-control" id="classTime" required></div>
                <div class="col-md-6"><label for="classModality" class="form-label">Modalidade</label><input type="text" class="form-control" id="classModality" required></div>
                <div class="col-md-6"><label for="classInstructor" class="form-label">Instrutor</label><input type="text" class="form-control" id="classInstructor" required></div>
                <div class="col-md-6"><label for="classTotalSlots" class="form-label">Total de Vagas</label><input type="number" class="form-control" id="classTotalSlots" required></div>
            </form>
        </div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="submit" form="classForm" class="btn btn-primary">Salvar Aula</button></div>
    </div></div></div>

    <!-- Modal Matrícula na Aula -->
    <div class="modal fade" id="enrollModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content glass-effect">
        <div class="modal-header"><h5 class="modal-title" id="enrollModalTitle"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body"><form id="enrollForm"></form></div>
        <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button><button type="submit" form="enrollForm" class="btn btn-primary">Salvar Matrículas</button></div>
    </div></div></div>
    
    <!-- Modal Detalhes (Cliente e Plano) -->
    <div class="modal fade" id="detailsModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content glass-effect">
        <div class="modal-header"><h5 class="modal-title" id="detailsModalTitle"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body" id="detailsModalBody"></div>
    </div></div></div>
    
    <!-- Modal Confirmação de Exclusão -->
    <div class="modal fade" id="deleteModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content glass-effect">
        <div class="modal-header"><h5 class="modal-title">Confirmar Exclusão</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body"><p>Você tem certeza que deseja excluir este item? Esta ação não pode ser desfeita.</p></div>
        <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button id="confirmDeleteBtn" class="btn btn-danger">Excluir</button></div>
    </div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // =================================================================================
        // INICIALIZAÇÃO E GERENCIAMENTO DE DADOS (localStorage)
        // =================================================================================

        const showToast = (title, message) => {
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastBody').textContent = message;
            appToast.show();
        };

        const getStore = (key, defaultData) => {
            const data = localStorage.getItem(key);
            if (!data) {
                setStore(key, defaultData);
                return defaultData;
            }
            return JSON.parse(data);
        };
        const setStore = (key, data) => localStorage.setItem(key, JSON.stringify(data));
        
        // Para demonstração, adiciona uma aula para o dia de hoje.
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        const todayString = `${year}-${month}-${day}`;

        const initialClients = [
            { id: 1, name: "Bruno Felipe", email: "bruno.f@email.com", age: 22, goal: "Hipertrofia", status: "Ativo", planId: 1 },
            { id: 2, name: "Saulo Araujo", email: "saulo.a@email.com", age: 25, goal: "Hipertrofia", status: "Ativo", planId: 1 },
            { id: 3, name: "Moizes Souza", email: "moizes.s@email.com", age: 28, goal: "Condicionamento", status: "Ativo", planId: 3 }
        ];
        const initialPlans = [
            { id: 1, name: "Projeto Hipertrofia", duration: "12 semanas", level: "Iniciante", responsible: "Carlos", exercises: ["Supino Reto 4x8", "Agachamento Livre 4x10", "Remada Curvada 3x10"] },
            { id: 2, name: "Foco Emagrecimento", duration: "8 semanas", level: "Iniciante", responsible: "Ana", exercises: ["Corrida 30min", "Bicicleta 20min", "Prancha 3x1min"] },
            { id: 3, name: "Condicionamento Total", duration: "6 semanas", level: "Intermediário", responsible: "Fernando", exercises: ["Burpees 3x15", "Swing com Kettlebell 4x20", "Salto na Caixa 3x12"] }
        ];
        const initialClasses = [
            { id: 1, date: todayString, time: "07:00", modality: "Yoga Matinal", instructor: "Isabela Rocha", totalSlots: 20, enrolled: [1, 3] },
            { id: 2, date: todayString, time: "18:30", modality: "Zumba Dance", instructor: "Thiago Santos", totalSlots: 25, enrolled: [2] },
            { id: 3, date: "2025-10-08", time: "19:00", modality: "Cross Training", instructor: "Rodrigo Diniz", totalSlots: 15, enrolled: [1, 2, 3] }
        ];
        
        let clients = getStore('neon-academy-clients', initialClients);
        let plans = getStore('neon-academy-plans', initialPlans);
        let classes = getStore('neon-academy-classes', initialClasses);

        const modals = {
            client: new bootstrap.Modal('#clientModal'),
            plan: new bootstrap.Modal('#planModal'),
            class: new bootstrap.Modal('#classModal'),
            details: new bootstrap.Modal('#detailsModal'),
            enroll: new bootstrap.Modal('#enrollModal'),
            delete: new bootstrap.Modal('#deleteModal'),
        };
        const appToast = new bootstrap.Toast('#appToast');

        // =================================================================================
        // FUNÇÕES DE RENDERIZAÇÃO (Exibir dados na tela)
        // =================================================================================

        const renderAll = () => {
            renderClients();
            renderPlans();
            renderClasses();
            updateDashboard();
        };

        const renderClients = () => {
            const clientTableBody = document.getElementById('clientTableBody');
            const searchTerm = document.getElementById('clientSearch').value.toLowerCase();
            clientTableBody.innerHTML = clients.filter(c => c.name.toLowerCase().includes(searchTerm)).map(c => {
                const plan = plans.find(p => p.id == c.planId);
                return `
                <tr id="client-${c.id}">
                    <td>${c.name}</td>
                    <td>${plan ? plan.name : '<span class="text-white">Nenhum</span>'}</td>
                    <td><span class="badge" style="background-color: ${c.status === 'Ativo' ? 'var(--success-color)' : 'var(--danger-color)'};">${c.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-view-client" data-id="${c.id}" style="color:var(--primary-color)"><i class="bi bi-eye-fill"></i></button>
                        <button class="btn btn-sm btn-edit-client" data-id="${c.id}" style="color:var(--warning-color)"><i class="bi bi-pencil-fill"></i></button>
                        <button class="btn btn-sm btn-delete" data-id="${c.id}" data-type="clients" style="color:var(--danger-color)"><i class="bi bi-trash-fill"></i></button>
                    </td>
                </tr>`
            }).join('');
        };
        
        const renderPlans = () => {
             document.getElementById('plansContainer').innerHTML = plans.map(p => `
                <div class="col-md-6 col-lg-4" id="plan-${p.id}">
                    <div class="card glass-effect h-100 d-flex flex-column">
                        <div class="card-body">
                            <h5 class="card-title" style="color:var(--primary-color)">${p.name}</h5>
                            <p class="card-text mb-1" style="color: rgba(255, 255, 255, 0.5);">Duração: ${p.duration}</p>
                            <p class="card-text mb-1" style="color: rgba(255, 255, 255, 0.5);">Nível: ${p.level}</p>
                            <p class="card-text" style="color: rgba(255, 255, 255, 0.5);">Responsável: ${p.responsible}</p>
                        </div>
                        <div class="card-footer bg-transparent border-0 pt-0 pb-3 px-3">
                           <div class="d-flex gap-2">
                             <button class="btn btn-outline-primary w-100 btn-view-plan" data-id="${p.id}">Exercícios</button>
                             <button class="btn btn-outline-warning btn-edit-plan" data-id="${p.id}"><i class="bi bi-pencil-fill"></i></button>
                             <button class="btn btn-outline-danger btn-delete" data-id="${p.id}" data-type="plans"><i class="bi bi-trash-fill"></i></button>
                           </div>
                        </div>
                    </div>
                </div>`).join('');
        };
        
        const renderClasses = () => {
            document.getElementById('classesTableBody').innerHTML = classes.map(c => {
                const availableSlots = c.totalSlots - c.enrolled.length;
                return `
                <tr id="class-${c.id}">
                    <td>${new Date(c.date + 'T00:00:00-03:00').toLocaleDateString()}</td><td>${c.time}</td><td>${c.modality}</td><td>${c.instructor}</td>
                    <td><span style="color: ${availableSlots > 0 ? 'var(--success-color)' : 'var(--danger-color)'}">${availableSlots}/${c.totalSlots}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary btn-enroll" data-id="${c.id}">Gerenciar Vagas</button>
                        <button class="btn btn-sm btn-edit-class" data-id="${c.id}" style="color:var(--warning-color)"><i class="bi bi-pencil-fill"></i></button>
                        <button class="btn btn-sm btn-delete" data-id="${c.id}" data-type="classes" style="color:var(--danger-color)"><i class="bi bi-trash-fill"></i></button>
                    </td>
                </tr>`;
            }).join('');
        };

        const updateDashboard = () => {
            document.getElementById('dashboard-clients').textContent = clients.filter(c => c.status === 'Ativo').length;
            document.getElementById('dashboard-plans').textContent = plans.length;
            document.getElementById('dashboard-classes').textContent = classes.length;
            renderUpcomingClasses();
            renderRecentClients();
        };

        const renderUpcomingClasses = () => {
            const container = document.getElementById('upcoming-classes-container');
            const now = new Date();
            
            const upcoming = classes
                .filter(c => new Date(c.date + 'T' + c.time) >= now)
                .sort((a,b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time))
                .slice(0, 4);

            if(upcoming.length === 0){
                container.innerHTML = `<p class="text-white text-center">Nenhuma aula agendada.</p>`;
                return;
            }

            container.innerHTML = upcoming.map(c => {
                const occupancy = (c.enrolled.length / c.totalSlots) * 100;
                return `
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0 text-white">${c.modality}</h6>
                                <small style="color: rgba(255, 255, 255, 0.5);">${new Date(c.date + 'T00:00:00-03:00').toLocaleDateString()} às ${c.time} - ${c.instructor}</small>
                            </div>
                            <button class="btn btn-sm btn-outline-primary btn-enroll" data-id="${c.id}">Gerenciar</button>
                        </div>
                        <div class="progress mt-2" style="height: 8px;">
                            <div class="progress-bar" role="progressbar" style="width: ${occupancy}%" aria-valuenow="${occupancy}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                `
            }).join('');
        };

        const renderRecentClients = () => {
            const container = document.getElementById('recent-clients-container');
            const recent = clients.slice().sort((a, b) => b.id - a.id).slice(0, 4);

            if (recent.length === 0) {
                container.innerHTML = `<p class="text-white text-center">Nenhum cliente recente.</p>`;
                return;
            }

            container.innerHTML = recent.map(client => `
                <div class="d-flex align-items-center mb-3">
                    <div class="icon-circle me-3">
                        <i class="bi bi-person-fill fs-5" style="color: var(--primary-color);"></i>
                    </div>
                    <div>
                        <h6 class="mb-0 text-white">${client.name}</h6>
                        <small style="color: rgba(255, 255, 255, 0.5);">${client.goal}</small>
                    </div>
                </div>
            `).join('');
        };

        // =================================================================================
        // MANIPULAÇÃO DE FORMULÁRIOS E MODAIS (CRUD)
        // =================================================================================
        const forms = document.querySelectorAll('.needs-validation');
        forms.forEach(form => {
            form.addEventListener('submit', e => {
                if (!form.checkValidity()) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
        
        const openClientModal = (id = null) => {
            const form = document.getElementById('clientForm');
            form.classList.remove('was-validated');
            form.reset();
            
            const planSelect = document.getElementById('clientPlan');
            planSelect.innerHTML = '<option value="">Nenhum</option>' + plans.map(p => `<option value="${p.id}">${p.name}</option>`).join('');

            if (id) {
                const client = clients.find(c => c.id == id);
                document.getElementById('clientModalTitle').textContent = 'Editar Cliente';
                document.getElementById('clientId').value = client.id;
                document.getElementById('clientName').value = client.name;
                document.getElementById('clientEmail').value = client.email;
                document.getElementById('clientAge').value = client.age;
                document.getElementById('clientGoal').value = client.goal;
                document.getElementById('clientStatus').value = client.status;
                planSelect.value = client.planId || "";
            } else {
                document.getElementById('clientModalTitle').textContent = 'Cadastrar Novo Cliente';
                document.getElementById('clientId').value = '';
            }
            modals.client.show();
        };

        const saveClient = (e) => {
            e.preventDefault();
            const form = document.getElementById('clientForm');
            if (!form.checkValidity()) return;
            
            const id = document.getElementById('clientId').value;
            const clientData = {
                name: document.getElementById('clientName').value,
                email: document.getElementById('clientEmail').value,
                age: parseInt(document.getElementById('clientAge').value),
                goal: document.getElementById('clientGoal').value,
                status: document.getElementById('clientStatus').value,
                planId: document.getElementById('clientPlan').value ? parseInt(document.getElementById('clientPlan').value) : null
            };

            if (id) {
                clients = clients.map(c => c.id == id ? { ...c, ...clientData } : c);
            } else {
                clientData.id = Date.now();
                clients.push(clientData);
            }
            
            setStore('neon-academy-clients', clients);
            renderAll();
            modals.client.hide();
            showToast('Sucesso', 'Cliente salvo com sucesso!');
        };
        
        const openPlanModal = (id = null) => {
             const form = document.getElementById('planForm');
            form.classList.remove('was-validated');
            form.reset();
            const exercisesContainer = document.getElementById('exercisesContainer');
            exercisesContainer.innerHTML = '';

            if(id){
                const plan = plans.find(p => p.id == id);
                document.getElementById('planModalTitle').textContent = 'Editar Plano de Treino';
                document.getElementById('planId').value = plan.id;
                document.getElementById('planName').value = plan.name;
                document.getElementById('planDuration').value = plan.duration;
                document.getElementById('planLevel').value = plan.level;
                document.getElementById('planResponsible').value = plan.responsible;
                plan.exercises.forEach(ex => addExerciseInput(ex));
            } else {
                document.getElementById('planModalTitle').textContent = 'Criar Novo Plano';
                document.getElementById('planId').value = '';
                addExerciseInput();
            }
            modals.plan.show();
        };

        const savePlan = (e) => {
            e.preventDefault();
            const form = document.getElementById('planForm');
            if (!form.checkValidity()) return;

            const id = document.getElementById('planId').value;
            const exercises = [...document.querySelectorAll('#exercisesContainer input')].map(input => input.value).filter(val => val);
            
            const planData = {
                name: document.getElementById('planName').value,
                duration: document.getElementById('planDuration').value,
                level: document.getElementById('planLevel').value,
                responsible: document.getElementById('planResponsible').value,
                exercises: exercises
            };
            
            if (id) {
                plans = plans.map(p => p.id == id ? { ...p, ...planData } : p);
            } else {
                planData.id = Date.now();
                plans.push(planData);
            }

            setStore('neon-academy-plans', plans);
            renderAll();
            modals.plan.hide();
            showToast('Sucesso', 'Plano salvo com sucesso!');
        };

        const openClassModal = (id = null) => {
            const form = document.getElementById('classForm');
            form.classList.remove('was-validated');
            form.reset();
            if(id){
                const classItem = classes.find(c => c.id == id);
                document.getElementById('classModalTitle').textContent = 'Editar Aula';
                document.getElementById('classId').value = classItem.id;
                document.getElementById('classDate').value = classItem.date;
                document.getElementById('classTime').value = classItem.time;
                document.getElementById('classModality').value = classItem.modality;
                document.getElementById('classInstructor').value = classItem.instructor;
                document.getElementById('classTotalSlots').value = classItem.totalSlots;
            } else {
                document.getElementById('classModalTitle').textContent = 'Agendar Nova Aula';
                document.getElementById('classId').value = '';
            }
            modals.class.show();
        };

        const saveClass = (e) => {
            e.preventDefault();
            const form = document.getElementById('classForm');
            if (!form.checkValidity()) return;

            const id = document.getElementById('classId').value;
            const classData = {
                date: document.getElementById('classDate').value,
                time: document.getElementById('classTime').value,
                modality: document.getElementById('classModality').value,
                instructor: document.getElementById('classInstructor').value,
                totalSlots: parseInt(document.getElementById('classTotalSlots').value),
            };

            if(id){
                classes = classes.map(c => c.id == id ? { ...c, ...classData } : c);
            } else {
                classData.id = Date.now();
                classData.enrolled = [];
                classes.push(classData);
            }
            setStore('neon-academy-classes', classes);
            renderAll();
            modals.class.hide();
            showToast('Sucesso', 'Aula salva com sucesso!');
        };

        const openEnrollModal = (id) => {
            const classItem = classes.find(c => c.id == id);
            document.getElementById('enrollModalTitle').textContent = `Matricular em ${classItem.modality}`;
            const enrollForm = document.getElementById('enrollForm');
            enrollForm.dataset.classId = id;
            
            enrollForm.innerHTML = clients.map(client => `
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="${client.id}" id="enroll-client-${client.id}" 
                        ${classItem.enrolled.includes(client.id) ? 'checked' : ''}>
                    <label class="form-check-label" for="enroll-client-${client.id}">${client.name}</label>
                </div>
            `).join('');

            modals.enroll.show();
        };

        const saveEnrollments = (e) => {
            e.preventDefault();
            const classId = e.target.dataset.classId;
            const classItem = classes.find(c => c.id == classId);
            const selectedClients = [...document.querySelectorAll('#enrollForm input:checked')].map(input => parseInt(input.value));
            
            if (selectedClients.length > classItem.totalSlots) {
                showToast('Erro', `Não é possível matricular ${selectedClients.length} alunos. Apenas ${classItem.totalSlots} vagas no total.`);
                return;
            }

            classItem.enrolled = selectedClients;
            setStore('neon-academy-classes', classes);
            renderAll();
            modals.enroll.hide();
            showToast('Sucesso', 'Matrículas atualizadas com sucesso!');
        };
        
        let itemToDelete = { id: null, type: null };
        const openDeleteModal = (id, type) => {
            itemToDelete = { id, type };
            modals.delete.show();
        };

        const confirmDelete = () => {
            const { id, type } = itemToDelete;
            if (type === 'clients') {
                clients = clients.filter(c => c.id != id);
                setStore('neon-academy-clients', clients);
            } else if (type === 'plans') {
                plans = plans.filter(p => p.id != id);
                setStore('neon-academy-plans', plans);
            } else if(type === 'classes'){
                classes = classes.filter(c => c.id != id);
                setStore('neon-academy-classes', classes);
            }
            renderAll();
            modals.delete.hide();
            showToast('Sucesso', 'Item excluído com sucesso.');
        };
        
        const showDetailsModal = (title, content) => {
            document.getElementById('detailsModalTitle').textContent = title;
            document.getElementById('detailsModalBody').innerHTML = content;
            modals.details.show();
        };

        const addExerciseInput = (value = '') => {
            const div = document.createElement('div');
            div.className = 'input-group mb-2';
            div.innerHTML = `<input type="text" class="form-control" value="${value}" placeholder="Ex: Supino Reto 4x8" required><button class="btn btn-outline-danger btn-remove-exercise" type="button"><i class="bi bi-trash"></i></button>`;
            document.getElementById('exercisesContainer').appendChild(div);
        };
        
        // =================================================================================
        // EVENT LISTENERS
        // =================================================================================
        document.getElementById('btn-add-client').addEventListener('click', () => openClientModal());
        document.getElementById('clientForm').addEventListener('submit', saveClient);
        
        document.getElementById('btn-add-plan').addEventListener('click', () => openPlanModal());
        document.getElementById('planForm').addEventListener('submit', savePlan);
        document.getElementById('addExercise').addEventListener('click', () => addExerciseInput());
        
        document.getElementById('btn-add-class').addEventListener('click', () => openClassModal());
        document.getElementById('classForm').addEventListener('submit', saveClass);

        document.getElementById('enrollForm').addEventListener('submit', saveEnrollments);
        
        document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
        document.getElementById('clientSearch').addEventListener('keyup', renderClients);

        document.querySelector('.main-content').addEventListener('click', e => {
            const target = e.target.closest('button');
            if (!target) return;

            const id = target.dataset.id;
            if (target.matches('.btn-edit-client')) openClientModal(id);
            if (target.matches('.btn-edit-plan')) openPlanModal(id);
            if (target.matches('.btn-edit-class')) openClassModal(id);
            if (target.matches('.btn-delete')) openDeleteModal(id, target.dataset.type);
            if (target.matches('.btn-enroll')) openEnrollModal(id);
            
            if(target.matches('.btn-view-plan')) {
                const plan = plans.find(p => p.id == id);
                const content = `<ul class="list-group list-group-flush">${plan.exercises.map(ex => `<li class="list-group-item bg-transparent border-secondary text-light">${ex}</li>`).join('')}</ul>`;
                showDetailsModal(`Exercícios: ${plan.name}`, content);
            }
            if(target.matches('.btn-view-client')){
                const client = clients.find(c => c.id == id);
                const plan = plans.find(p => p.id == client.planId);
                const content = `
                    <p><strong>Email:</strong> ${client.email}</p>
                    <p><strong>Idade:</strong> ${client.age}</p>
                    <p><strong>Objetivo:</strong> ${client.goal}</p>
                    <p><strong>Plano Ativo:</strong> ${plan ? plan.name : 'Nenhum'}</p>`;
                showDetailsModal(`Detalhes de ${client.name}`, content);
            }
            if(target.matches('.btn-remove-exercise')) {
                target.closest('.input-group').remove();
            }
        });

        // Navegação entre páginas
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                const pageId = link.getAttribute('data-page');
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                link.classList.add('active');
                document.getElementById(pageId)?.classList.add('active');
            });
        });
        
        // Renderização inicial de todos os dados
        renderAll();
    });
    </script>
</body>
</html>

